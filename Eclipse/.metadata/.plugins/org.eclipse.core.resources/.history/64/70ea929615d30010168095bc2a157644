package edu.pipeline;

import java.io.File;
import java.util.HashSet;
import java.util.Set;

/**
 * A server should hold onto a FileManagerSet. A file manager set contains a
 * bunch of file managers. Its main functionality is to be provided with a
 * rootpath and get the associated file manager. This can be passed to the
 * checker to figure out its associated file manager. Additionally, it lets us
 * easily check for & remove unneeded file managers.
 */
public class FileManagerSet {
	private final Set<FileManager> fileManagers;

	public FileManagerSet() {
		fileManagers = new HashSet<>();
	}

	public void add(FileManager m) {
		fileManagers.add(m);
	}

	/**
	 * TODO Should remove all file managers from the set that aren't worth their
	 * salt.
	 */
	public void checkWorthlessAndCleanup(FileManager manager) {
		if (manager.isWorthless()) {
			
			System.err.println("Manager is worthless, closing it.");
			fileManagers.remove(manager);
		}
	}

	public void closeFile(File f) {
		for (FileManager manager : fileManagers) {
			if (!manager.isRootOf(f))
				continue;
			Rootpath predicted_root_path = manager.getRootpathOf(f);
			if (!manager.has(predicted_root_path))
				continue;
			manager.close(predicted_root_path);
			checkWorthlessAndCleanup(manager);
		}
	}
	
	public void removeSingletonFromManagers(File f) {
		for (FileManager manager : fileManagers) {
			Rootpath rp = manager.getRootpathOf(f);
			if (manager.has)
		}
		
	}

	/**
	 * Gets the FileManager that this rootpath points to. Note that the FileManager
	 * does not have to actually have the rootpath registered. If no FileManager
	 * exists, returns null.
	 * 
	 * @param rootpath
	 * @param f
	 * @return
	 */
	public FileManager getOughtManager(Rootpath rootpath, File f) {
		for (FileManager manager : fileManagers) {
			if (manager.isRootOf(rootpath, f))
				return manager;
		}
		return null;
	}

	/**
	 * Gets the FileManager that has this rootpath registered. If no FileManager has
	 * this rootpath registered, then returns null.
	 * 
	 * @param rootpath
	 * @return
	 */
	public FileManager getIsManager(Rootpath rootpath) {
		for (FileManager manager : fileManagers) {
			if (manager.has(rootpath))
				return manager;
		}
		return null;
	}
}
